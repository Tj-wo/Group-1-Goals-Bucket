<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui" template="/pages/californiatemplate/template.xhtml">

    <ui:define name="content">
        <div class="layout-wrapper component-panel">
            <h:form id="staffView">
                <p:panel header="Staff Management">
                    <p:growl id="globalGrowl" showDetail="true" life="5000" />

                    <p:toolbar styleClass="p-mb-4">
                        <p:toolbarGroup align="left">
                            <p:inputText placeholder="Search for staff..." value="#{staffView.searchTerm}">
                                <p:ajax event="keyup" listener="#{staffView.reloadFilterReset()}" update="staffTable" />
                            </p:inputText>
                            <p:commandButton styleClass="p-ml-2 primary-button" id="searchBtn"
                                actionListener="#{staffView.reloadFilterReset()}" update="staffView" value="Search" />
                        </p:toolbarGroup>
                        <p:toolbarGroup align="right">
                            <p:commandButton icon="pi pi-plus" value="Add Staff Member"
                                actionListener="#{staffFormDialog.show}">
                                <f:setPropertyActionListener value="#{null}" target="#{staffFormDialog.model}" />
                                <p:ajax event="dialogReturn" listener="#{staffView.reloadFilterReset()}"
                                    update="staffTable" />
                            </p:commandButton>
                        </p:toolbarGroup>
                    </p:toolbar>

                    <p:dataTable id="staffTable" var="staff" value="#{staffView.dataModels}" widgetVar="staffTable"
                        paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
                        paginator="true" lazy="true" rows="#{staffView.maximumresultsPerpage}"
                        emptyMessage="#{staffView.dataEmptyMessage}" paginatorPosition="bottom"
                        paginatorAlwaysVisible="false" rowIndexVar="row" reflow="true" styleClass="TableAlgnment">

                        <f:facet name="header">
                            Staff Members
                        </f:facet>

                        <p:column headerText="First Name">
                            <h:outputText value="#{staff.userAccount.firstName}" />
                        </p:column>

                        <p:column headerText="Last Name">
                            <h:outputText value="#{staff.userAccount.lastName}" />
                        </p:column>

                        <p:column headerText="Email Address">
                            <h:outputText value="#{staff.userAccount.emailAddress}" />
                        </p:column>

                        <p:column headerText="Phone Number">
                            <h:outputText value="#{staff.userAccount.phoneNumber}" />
                        </p:column>

                        <p:column headerText="Gender">
                            <h:outputText
                                value="#{staff.userAccount.gender != null ? staff.userAccount.gender.name() : 'N/A'}" />
                        </p:column>

                        <p:column headerText="Staff Status">
                            <p:tag value="#{staff.staffStatus}" rounded="true"
                                styleClass="#{staff.staffStatus == 'ACTIVE' ? 'ui-tag-success' : 'ui-tag-danger'}" />
                        </p:column>

                        <p:column headerText="Account Status">
                            <p:tag
                                value="#{staff.userAccount != null and staff.userAccount.recordStatus == 'ACTIVE' ? 'Active' : 'Inactive'}"
                                rounded="true"
                                styleClass="#{staff.userAccount != null and staff.userAccount.recordStatus == 'ACTIVE' ? 'ui-tag-success' : 'ui-tag-warning'}" />
                        </p:column>

                        <p:column headerText="Access Status">
                            <p:tag value="#{staff.active ? 'Can Access' : 'Blocked'}" rounded="true"
                                styleClass="#{staff.active ? 'ui-tag-success' : 'ui-tag-danger'}" />
                        </p:column>

                        <p:column headerText="Actions">
                            <p:commandButton icon="pi pi-pencil" styleClass="ui-button-help" immediate="true"
                                actionListener="#{staffFormDialog.show}">
                                <f:setPropertyActionListener value="#{staff}" target="#{staffFormDialog.model}" />
                            </p:commandButton>


                            <p:commandButton value="Activate Account"
                                actionListener="#{staffView.activateAccount(staff)}" update="staffTable" process="@this"
                                rendered="#{staff.staffStatus != 'ACTIVE' or !staff.active}"
                                styleClass="ui-button-success p-ml-2"
                                confirmMessage="Are you sure you want to activate this staff member's account?" />


                            <p:commandButton value="Deactivate Account"
                                actionListener="#{staffView.deactivateAccount(staff)}" update="staffTable"
                                process="@this" rendered="#{staff.staffStatus == 'ACTIVE' and staff.active}"
                                styleClass="ui-button-danger p-ml-2"
                                confirmMessage="Are you sure you want to deactivate this staff member's account? They will lose access to the system." />
                        </p:column>
                    </p:dataTable>
                </p:panel>
            </h:form>
        </div>
    </ui:define>
</ui:composition>